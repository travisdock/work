<div class="notebook-page">
  <div class="page-header">
    <div class="task-header">
      <div class="priority-mark priority-<%= @task.priority_number %>">
        <%= "!" * @task.priority_number %>
      </div>

      <div class="task-info">
        <h1 class="task-title"><%= @task.title %></h1>
        <span class="task-status status-<%= @task.status %>">
          <%= @task.status.humanize %>
        </span>
      </div>
    </div>

    <div class="page-actions">
      <%= link_to "Edit", edit_project_task_path(@project, @task), class: "btn btn-secondary" %>
      <%= link_to "Back to Project", @project, class: "btn btn-text" %>
    </div>
  </div>

  <% if @task.description.present? %>
    <div class="task-description">
      <p><%= simple_format(@task.description) %></p>
    </div>
  <% end %>

  <% if @task.next_action.present? %>
    <div class="next-action">
      <strong>Next Action:</strong> <%= @task.next_action %>
    </div>
  <% end %>

  <div class="task-meta">
    <% if @task.start_date %>
      <span class="start-date">Started: <%= @task.start_date.strftime("%b %d, %Y") %></span>
    <% end %>

    <% if @task.due_date %>
      <span class="due-date <%= 'overdue' if @task.due_date < Date.current %>">
        Due: <%= @task.due_date.strftime("%b %d, %Y") %>
      </span>
    <% end %>

    <% if @task.priority_tags.any? %>
      <div class="priority-tags">
        <% @task.priority_tags.each do |tag| %>
          <span class="tag tag-<%= tag %>"><%= tag %></span>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if @subtasks.any? %>
    <div class="subtasks-section">
      <h2>Subtasks</h2>
      <div class="tasks-list">
        <% @subtasks.each do |subtask| %>
          <%= render 'tasks/task_item', task: subtask, show_project: false %>
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="task-actions">
    <% unless @task.done? %>
      <%= link_to "Complete Task", complete_task_path(@task),
                  class: "btn btn-primary",
                  data: {
                    turbo_method: :patch,
                    turbo_confirm: "Mark this task as complete?"
                  } %>
    <% end %>
    <%= link_to "Delete Task", [@project, @task],
                class: "btn btn-text text-error",
                data: {
                  turbo_method: :delete,
                  turbo_confirm: "Are you sure? This will delete all subtasks too."
                } %>
  </div>
</div>
